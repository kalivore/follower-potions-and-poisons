Ever found it frustrating that followers wait until the last second before using potions?  What use is a minor Restore Health if they're dead on the next hit?

How about all those Fortify and Resist potions that you cook up for your followers, which they totally ignore?  How annoying is it when they charge straight into battle, blissfully unaware of the advantage you've tried to provide?

This mod aims to change all that, allowing followers to use their potions intelligently, and keep them in the fight longer.


[line]
[center][font=Courier New][color=#ff0000][size=4][b]- [ CURRENTLY IN BETA ] -[/b][/size][/color]

[color=#dd0000]Please note, this is the first release of my first mod, and as such I'm considering it still in beta stage.  It is feature-complete (though there is still more I would like to do), and I consider it usable [i]enough[/i] to see how it performs on other people's systems.  That said, it is still untested on anything other than my machine.

This mod may change significantly before a final release - as such, please [b]ONLY[/b] install it on a savegame you are happy to revert if necessary.

And for the love of Talos, make (and keep!) a backup of your save before installing this.[/color][/font][/center]
[line]


[font=Georgia][color=#8e7cc3][size=3][b]Installing[/b][/size][/color][/font]

No special procedure - install normally with a mod manager (I recommend [url=http://www.nexusmods.com/skyrim/mods/1334/]Mod Organizer[/url]), or manually if that's how you roll.

[b]Requires:[/b]

[list]
[*][size=2]SKSE v1.7.3 (get it from [url=http://skse.silverlock.org]skse.silverlock.org[/url]).  The mod just straight-up won't work without this.[/size]
[*][size=2][url=http://www.nexusmods.com/skyrim/mods/3863]SkyUI[/url] is also a functional requirement. The mod [i]will[/i], technically, work without it, but you won't be able to configure [i]anything[/i] without the MCM, so I really wouldn't recommend it.[/size]
[*][size=2]This mod also uses the [url=http://www.nexusmods.com/skyrim/mods/78986]Inventory Functions[/url] SKSE plugin.  This was originally by Quad2Core, but did not work with SKSE 1.7.3.  I have updated the plugin, and it is included in this mod.  It's also hosted standalone, in case it's handy to anyone else.[/size]
[/list]


[font=Georgia][color=#8e7cc3][size=3][b]Telling followers to use potions[/b][/size][/color][/font]

Any NPC in the Current Follower Faction will have a new dialogue option: "[i]Concerning potions..[/i]".  Select this to tell them to start, or stop, using potions in their inventory.  A maximum of fifteen followers can be tracked by this mod - any more than that, and they're on their own.

By default, animal followers (eg dogs and horses) are excluded, as they don't tend to have potions.  Or inventories.  Or, y'know, opposable thumbs..  If you definitely do want your animal to swig potions with the rest, there is a means to do this (see the Compatibility section below).



[center][font=Georgia][color=#8e7cc3][size=4][b]What This Does[/b][/size][/color][/font][/center]
I developed this because I was tired of my followers taking a face-full of dragon fire in the first four seconds of an attack, and passing out for the rest of the fight.  There are two main areas it covers: Restore potions, and Fortify/Resist potions.


[font=Georgia][size=3][b][color=#8e7cc3]Restore [/color][color=#ff0000]Health[/color]/[color=#00ff00]Stamina[/color]/[color=#1155cc]Magicka[/color][/b][/size][/font]

Followers will now use Restore potions when the relevant stat drops below a configurable percentage - rather than when it's nearly exhausted, if at all (as I tend to notice in the vanilla game).  For example, Health can be kept at a minimum 60% level, reducing the chances of a single power attack wiping out your follower before they have chance to heal.  A mage can keep at least 70% Magicka available, meaning they won't be left high and dry when they want to cast that big, flashy, scenery-levelling mega-spell.


[size=3][font=Georgia][color=#8e7cc3][b]Fortify and Resist[/b][/color][/font][/size]

Followers can be set to use any or all of the following Fortify potions on starting combat, provided it makes sense for them to do so:

[list]
[*][size=2]Health, Stamina, Magicka[/size]
[size=2]
[/size][*][size=2]Heal rate, Stamina rate, Magicka rate[/size]
[size=2]
[/size][*][size=2]Marksman, Block, One-Handed, Two-Handed[/size]
[size=2][color=#d8d8d8][i]To use these, the follower must also be holding a bow/crossbow, shield, one-handed weapon or two-handed weapon respectively.[/i][/color]

[/size][*][size=2]Light Armour, Heavy Armour[/size]
[size=2][i][color=#d8d8d8]T[i]o use these, [/i]the follower must [i]also [/i]be wearing at least one item with the [/color][/i][i][color=#d8d8d8]relevant Keyword (ArmorLight/ArmorHeavy respectively)[/color][/i]

[/size][*][size=2]Alteration, Conjuration, Destruction, Illusion, Restoration[/size]
[size=2][color=#d8d8d8][i][i]To use these, [/i]the follower must also know at least one spell from the corresponding School of magic[/i][/color]
[/size][/list]
Additionally, they can use any or all of the following Resist potions:

[list]
[*][size=2]Fire, Frost, Shock[/size]
[size=2][color=#d8d8d8][i][i][color=#d8d8d8]T[i]o use these, [/i][/color][/i]the follower's current enemy must also know at least one spell (or Shout) with the relevant Keyword (MagicDamageFire/MagicDamageFrost/MagicDamageShock, respectively)[/i][/color]

[/size][*][size=2]Magic[/size]
[size=2][i][color=#d8d8d8]If a follower uses a Resist Fire, Frost or Shock potion, they will follow up with a generic Resist Magic as well[/color][/i] 

[/size][*][size=2]Poison[/size]
[size=2][color=#d8d8d8][i]No special conditions for this - just needs to be enabled in the follower's MCM page[/i][/color][/size][/list]
With the MCM, you can set, for each follower, a difference in level between them and their current enemy which will trigger them to use these.  For example, if your follower is level 6, you can tell them to only use Fortify and Resist potions if fighting an enemy of level 10 or above.



[font=Georgia][size=4][b][center][color=#8e7cc3]MCM Menu[/color][/center][/b][/size][/font]
The potions a follower will use, along with the trigger levels when they should use them, can be set, per-follower, in the MCM menu provided by Sky UI.  The first page of the menu is Default settings for any new followers added.  Then there is one page of settings for each currently-tracked follower, to allow you to fine-tune behaviour.


[font=Georgia][color=#8e7cc3][size=3][b]Status and re-scanning potions[/b][/size][/color][/font]

The last MCM page will show you the status of all currently-tracked followers, and allows you to do things like reset them to the current defaults, or re-check their inventories for potions.  Normally, they keep their lists up-to-date as they acquire new potions (from you, from random barrels, or from the still-smoking remains of the Bandit you just incinerated).  However, in the event things have gone awry, there is the option here to fully re-scan and re-build their lists.



[font=Georgia][size=4][b][center][color=#8e7cc3]Compatibility[/color][/center][/b][/size][/font]
This should be compatible with pretty much everything.  No vanilla forms were touched or edited, so there should be no conflicts.  I did run this through the TES5Edit cleaning process as well, but with only a half-dozen forms, there really wasn't much for it to do.

As of v0.02, followers will check their equipment and enemies for certain vanilla Keywords before using certain Fortify or Resist potions (details in the Fortify and Resist section above).  Most mod-added items and spells [i]should[/i] have these set, as they're pretty commonplace and universal.

During development, I included explicit support for the following (and heartily recommend them):

[list]
[*][size=2][url=http://www.nexusmods.com/skyrim/mods/12933]Extensible Follower Framework[/url] by Expired[/size]
[size=2]If installed, followers will be tracked by this mod at the same time you first recruit them, and removed if you dismiss them.  There is also an option in the MCM to add anyone you give them 'Follow' command to.  That's mainly just a quick way to add all your existing followers - just use the Group -> Relax and Group -> Follow commands.  After that, you can disable the 'Add on Follow' option.

[/size][*][size=2][url=http://www.nexusmods.com/skyrim/mods/52681]NPC Knockout Overhaul[/url] by sevencardz[/size]
[size=2]A kind of compatibility-by-overlapping-design: Sevencardz applies a paralysis effect when NPCs are knocked out.  Followers in this mod will not use potions if they are paralysed.  So knocked-out followers can't use potions.  Neat, huh?

[/size][*][size=2][url=http://www.nexusmods.com/skyrim/mods/69306]Complete Alchemy and Cooking Overhaul[/url] by Kryptopyr[/size]
[size=2]CACO alters Restore potions to work over time, rather than immediately (I'm sure other mods do this too, but I love all the things CACO does).  Followers in this mod will not use a potion if they are already under the relevant effect - so they will wait until the Restore Health effect is finished before trying another Health potion.[/size][/list]
I'm aware there are various other follower mods out there (Advanced Follower Tweaks, Ultimate Follower Overhaul, Follower Live Package, Follower Mod..)  I've not explicitly tested any of these, so would be keen to know how they play with this mod.


[font=Georgia][color=#8e7cc3][size=3][b]Adding support for 'unusual' follower types[/b][/size][/color][/font]

By default, followers with any of the following Voice Types will [i]not[/i] show the dialogue options for this mod:

[list]
[*][size=2]CrDogVoice[/size]
[*][size=2]CrHorseVoice[/size]
[*][size=2]CrSabreCatVoice[/size]
[*][size=2]CrTrollVoice[/size]
[/list]
If you are the author of a follower mod, and would like your follower to be included even if they use one of these, you can use the keyword "[i]_FPP_IncludeDialogue[/i]".  This form is injected into Update.esm, with FormId [font=Courier New][color=#d9ead3][b]01F01001[/b][/color][/font].  Simply create a keyword in your mod with the same name and FormId (there are various tutorials on created injected keywords), and assign it to your mod's follower.  The Potion-related dialogue has an OR condition which checks for this keyword, and shows the dialogue option if it is assigned.



[font=Georgia][size=4][b][center][color=#8e7cc3]Performance[/color][/center][/b][/size][/font]
For avoidance of doubt: this [i]is[/i], out-and-out, a scripted mod.  I tried to get people to use potions via AI Packages, but I just couldn't make it as versatile as I wanted.  Magic Effects was an option I did (and still might) consider, but for now, the mod is event-driven by default, switching to update-driven when the first relevant potion is used (to avoid spamming events like OnHit), and switching back to events once the follower's stats are all above their set minimum levels.

In my testing, performance has generally been good, even on quite a script-heavy game.  For info, my test method was to recruit a dozen followers, give them all a couple of dozen potions, manually spawn twenty or so bandits at Fort Greymoor, toggle God Mode on (important, that bit!), and then Leeroy-Jenkins the hell outta it.  Oh, and I chucked a couple of dragons in the mix for good measure.  We still won.

Of course, everyone's mileage [i]will[/i] vary, which is another reason for this being a beta - please feed back to me your experiences with this.



[font=Georgia][size=4][b][center][color=#8e7cc3]Known Issues and Future Plans[/color][/center][/b][/size][/font]
As I might have mentioned(!), this is a beta.  There are a few things I'm aware of and intend to change in future versions, including (but not limited to):

[list]
[*][size=2]The annoying 'gloop' noise whenever a follower drinks a potion.  I hope there's a way to suppress that, cos it kinda bugs me.[/size]
[size=2]
[/size][*][size=2]I'm sure there's a better way to handle how and when followers use the Fortify and Resist potions - at the moment, it just doesn't seem.. [i]smart[/i] enough.[/size]
[/list]


[font=Georgia][size=4][b][center][color=#8e7cc3]Credits and Thanks[/color][/center][/b][/size][/font]
I took inspiration and example from several people when creating and coding this, but particular thanks are due to:

[list]
[*][size=2][b]Quad2Core [/b]- the "Inventory Functions" SKSE plugin was invaluable in being able to re-scan potion inventories in a reasonable amount of time.  Quad2Core's original plugin was designed for an earlier SKSE version, but thanks to them including the source code, I was able to re-work it for SKSE 1.7.3.  I tried to contact Quad2Core about hosting the updated version, but they've not been around for a while, so with the agreement of a Nexus admin, I've re-hosted it [url=http://www.nexusmods.com/skyrim/mods/78986]here[/url] (with a couple of my own tweaks and extensions).  Please feel free to use it for your own projects - but all credit is due to Quad2Core, not me.  They did the work; I just converted it.[/size]
[size=2]
[/size][*][size=2][b]Kryptopyr[/b] and [b]Chesko[/b] - it was delving into the multi-threaded async model in Kryptopyr's Complete Alchemy and Cooking Overhaul that led to me thinking I could use multi-threading here, and Chesko's tutorials [i]on[/i] that multi-threading approach are excellent.  I also got the approach for the real-time in-MCM progress updates from Checko's spectacular [url=http://www.nexusmods.com/skyrim/mods/11163]Frostfall[/url].[/size]
[size=2]
[/size][*][size=2][b]Apostrophic Labs[/b] - for the "Immortal" font used on the title page here and in the MCM[/size]
[size=2]
[/size][*][size=2][b]Bethesda[/b] - I guess it's only fair; they did make this game in the first place, and made it in such a way that, even now, people are still finding new and fun things to do with it..[/size]
[size=2]
[/size][*][size=2]..and finally, my girlfriend, who bought me my first copy of Skyrim, and who first introduced me to the vast, magical, distracting, and immersive (there, I said it!) world of Tamriel.  Or at least, the Nords' little corner of it..[/size]
[/list]